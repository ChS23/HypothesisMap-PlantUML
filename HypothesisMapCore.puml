' ===== HypothesisMapCore.puml =====
' –ü–∞–∫–µ—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è PlantUML –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –ö–∞—Ä—Ç –≥–∏–ø–æ—Ç–µ–∑
' –û—Å–Ω–æ–≤–∞–Ω –Ω–∞ –º–µ—Ç–æ–¥–æ–ª–æ–≥–∏–∏ –ê–ª–µ–∫—Å–∞–Ω–¥—Ä–∞ –ë—ã–Ω–¥—é (–∫–∞—Ä—Ç–∞–≥–∏–ø–æ—Ç–µ–∑.—Ä—Ñ)
' –í–µ—Ä—Å–∏—è: 1.0.0

left to right direction

' ======== –û–§–ò–¶–ò–ê–õ–¨–ù–´–ï –¶–í–ï–¢–ê ========

' –¶–≤–µ—Ç–∞ –∫–∞—Ä—Ç–æ—á–µ–∫ (–∏–∑ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞)
!$GOAL_COLOR = "#cee265"
!$SUBJECT_COLOR = "#f5d127" 
!$HYPOTHESIS_COLOR = "#fcf3af"
!$TASK_COLOR = "#c6d4f9"
!$NEGATIVE_SUBJECT_COLOR = "#ffc191"

' –¶–≤–µ—Ç–∞ —Ñ–æ–Ω–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤
!$HIGH_PRIORITY_BG = "#f24725"
!$MEDIUM_PRIORITY_BG = "#fef444"
!$LOW_PRIORITY_BG = "#8fd14f"

' –¶–≤–µ—Ç–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤ —Å–≤—è–∑–µ–π
!$HIGH_PRIORITY_LINE = "#f24726"
!$MEDIUM_PRIORITY_LINE = "#fbe32d"
!$LOW_PRIORITY_LINE = "#8fd14f"
!$DEFAULT_LINE = "#171717"

' ======== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ========

' –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–∞–∑–±–∏–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ –ø–æ —Å–∏–º–≤–æ–ª—É ; —Å –Ω—É–º–µ—Ä–∞—Ü–∏–µ–π
!function $formatList($text)
  !if ($text == "")
    !return ""
  !endif
  
  !$result = ""
  !$remaining = $text
  !$counter = 1
  !$pos = %strpos($remaining, ";")
  
  !while ($pos >= 0)
    !$item = %substr($remaining, 0, $pos)
    !if (%strlen($item) > 0)
      !$result = $result + $counter + ". " + $item + "\n"
      !$counter = $counter + 1
    !endif
    !$remaining = %substr($remaining, $pos+1)
    !$pos = %strpos($remaining, ";")
  !endwhile
  
  !if (%strlen($remaining) > 0)
    !$result = $result + $counter + ". " + $remaining
  !endif
  !return $result
!endfunction

!function $addSection($content, $title, $text)
  !if ($text != "")
    !return $content + "\n\n**" + $title + ":**\n" + $formatList($text)
  !endif
  !return $content
!endfunction

!function $addSimpleSection($content, $title, $text)
  !if ($text != "")
    !return $content + "\n\n**" + $title + ":** " + $text
  !endif
  !return $content
!endfunction

!function $getStatusEmoji($status)
  !if ($status == "–Ω–æ–≤–∞—è")
    !return "üÜï " + $status
  !elseif ($status == "—Å—Ä–∞–±–æ—Ç–∞–ª–∞")
    !return "‚úÖ " + $status
  !elseif ($status == "–æ—Ç–∫–ª–æ–Ω–µ–Ω–∞")
    !return "‚ùå " + $status
  !endif
  !return $status
!endfunction

' ======== –°–í–Ø–ó–ò ========

!unquoted procedure HighRel($from, $to, $label=" ")
  !if ($label == " ")
    $from -[#f24726,thickness=6]-> $to : <size:0>.</size>
  !else
    $from -[#f24726,thickness=6]-> $to : $label
  !endif
!endprocedure

!unquoted procedure MediumRel($from, $to, $label=" ")
  !if ($label == " ")
    $from -[#fbe32d,thickness=4]-> $to : <size:0>.</size>
  !else
    $from -[#fbe32d,thickness=4]-> $to : $label
  !endif
!endprocedure

!unquoted procedure LowRel($from, $to, $label=" ")
  !if ($label == " ")
    $from -[#8fd14f,thickness=1]-> $to : <size:0>.</size>
  !else
    $from -[#8fd14f,thickness=1]-> $to : $label
  !endif
!endprocedure

' ======== –û–°–ù–û–í–ù–´–ï –≠–õ–ï–ú–ï–ù–¢–´ ========

!unquoted procedure Goal($alias, $goal, $metrics="", $balancing_metrics="")
  !$content = $goal
  !$content = $addSection($content, "–ú–µ—Ç—Ä–∏–∫–∏", $metrics)
  !$content = $addSection($content, "–ë–∞–ª–∞–Ω—Å–∏—Ä—É—é—â–∏–µ", $balancing_metrics)
  rectangle "$content" as $alias
!endprocedure

!unquoted procedure Subject($alias, $goal_aliases, $description, $pains, $desires, $influence)
  !$content = $description
  !$content = $addSimpleSection($content, "–ë–æ–ª–∏", $pains)
  !$content = $addSimpleSection($content, "–ñ–µ–ª–∞–Ω–∏—è", $desires)
  rectangle "$content" as $alias
!endprocedure

!unquoted procedure NegativeSubject($alias, $goal_aliases, $description, $pains, $desires, $influence)
  !$content = $description
  !$content = $addSimpleSection($content, "–ë–æ–ª–∏", $pains)
  !$content = $addSimpleSection($content, "–ñ–µ–ª–∞–Ω–∏—è", $desires)
  rectangle "$content" as $alias
!endprocedure

!unquoted procedure Hypothesis($alias, $target_aliases, $if_part, $then_part, $because_part, $influence, $cost="", $status="", $reason="")
  !$content = "**–ï—Å–ª–∏:** " + $if_part + "\n\n**–¢–æ:** " + $then_part + "\n\n**–ü–æ—Ç–æ–º—É —á—Ç–æ:** " + $because_part
  !$content = $addSimpleSection($content, "–°—Ç–æ–∏–º–æ—Å—Ç—å", $cost)
  !if ($status != "")
    !$content = $addSimpleSection($content, "–°—Ç–∞—Ç—É—Å", $getStatusEmoji($status))
  !endif
  !$content = $addSimpleSection($content, "–ü—Ä–∏—á–∏–Ω–∞", $reason)
  rectangle "$content" as $alias
!endprocedure

!unquoted procedure Task($alias, $hypothesis_alias, $task_description, $readiness="", $deadline="")
  !$content = $task_description
  !if ($readiness != "")
    !$content = $addSimpleSection($content, "–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å", $readiness + "%")
  !endif
  !$content = $addSimpleSection($content, "–î–µ–¥–ª–∞–π–Ω", $deadline)
  rectangle "$content" as $alias
!endprocedure

!unquoted procedure Metric($alias, $goal_alias, $metric_text, $influence)
  rectangle "$metric_text" as $alias
  $goal_alias -[hidden]-> $alias 
  !if ($influence == 3)
    HighRel($alias, $goal_alias) 
  !elseif ($influence == 2)
    MediumRel($alias, $goal_alias)
  !else
    LowRel($alias, $goal_alias)
  !endif
!endprocedure

' ======== –ù–ê–°–¢–†–û–ô–ö–ò –ú–ê–ö–ï–¢–ê ========

!unquoted procedure LAYOUT_LEFT_TO_RIGHT()
  left to right direction
!endprocedure

' ======== –õ–ï–ì–ï–ù–î–ê ========

!unquoted procedure SHOW_HYPOTHESIS_LEGEND()
  legend right
    |<color:#cee265>  ‚ñ†  </color>| –¶–µ–ª—å, –º–µ—Ç—Ä–∏–∫–∏ |
    |<color:#f5d127>  ‚ñ†  </color>| –°—É–±—ä–µ–∫—Ç, –º–æ—Ç–∏–≤–∞—Ü–∏—è |
    |<color:#fcf3af>  ‚ñ†  </color>| –ì–∏–ø–æ—Ç–µ–∑–∞ |
    |<color:#c6d4f9>  ‚ñ†  </color>| –ó–∞–¥–∞—á–∞ |
    |<color:#ffc191>  ‚ñ†  </color>| –ù–µ–≥–∞—Ç–∏–≤–Ω—ã–π —Å—É–±—ä–µ–∫—Ç |
  endlegend
!endprocedure