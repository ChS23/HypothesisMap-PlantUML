' ===== HypothesisMapCore.puml =====
' –ü–∞–∫–µ—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è PlantUML –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π –ø–æ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –ê–ª–µ–∫—Å–∞–Ω–¥—Ä–∞ –ë—ã–Ω–¥—é (–∫–∞—Ä—Ç–∞–≥–∏–ø–æ—Ç–µ–∑.—Ä—Ñ)
' –í–µ—Ä—Å–∏—è: 1.0.1
' 
' –≠—Ç–æ—Ç —Ñ–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã –∏ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞—Ä—Ç –≥–∏–ø–æ—Ç–µ–∑.
' –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –º–µ—Ç–æ–¥–æ–ª–æ–≥–∏–∏: —Ü–µ–ª–∏, —Å—É–±—ä–µ–∫—Ç—ã, –≥–∏–ø–æ—Ç–µ–∑—ã, –∑–∞–¥–∞—á–∏.

' –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∏–∞–≥—Ä–∞–º–º—ã —Å–ª–µ–≤–∞ –Ω–∞–ø—Ä–∞–≤–æ –¥–ª—è –ª—É—á—à–µ–≥–æ –≤–æ—Å–ø—Ä–∏—è—Ç–∏—è
left to right direction
allowmixing

' ======== –ù–ê–°–¢–†–û–ô–ö–ò –ö–ê–ß–ï–°–¢–í–ê –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–Ø ========

!$DPI = 300
skinparam dpi $DPI

' ======== –ù–ê–°–¢–†–û–ô–ö–ò –ú–ê–ö–ï–¢–ê –ò –û–¢–°–¢–£–ü–û–í ========
' 
' –≠—Ç–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É—é—Ç —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –º–µ–∂–¥—É —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ –¥–∏–∞–≥—Ä–∞–º–º—ã:
' - nodesep: —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏ (–≤ –ø–∏–∫—Å–µ–ª—è—Ö)
' - ranksep: —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É —Ä—è–¥–∞–º–∏ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –ø–æ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏ (–≤ –ø–∏–∫—Å–µ–ª—è—Ö)  
' - padding: –æ–±—â–∏–µ –æ—Ç—Å—Ç—É–ø—ã –≤–æ–∫—Ä—É–≥ –≤—Å–µ–π –¥–∏–∞–≥—Ä–∞–º–º—ã (–≤ –ø–∏–∫—Å–µ–ª—è—Ö)

skinparam nodesep 50
skinparam ranksep 50

' –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–Ω–µ—à–Ω–µ–≥–æ –≤–∏–¥–∞ –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–æ–≤ (–∫–∞—Ä—Ç–æ—á–µ–∫ —ç–ª–µ–º–µ–Ω—Ç–æ–≤)
skinparam rectangle {
  BorderColor transparent
  roundCorner 0
  shadowing true
  skinparam padding 10
}

' –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è —Ä–æ–º–±–æ–≤ –≤–µ—Ç–≤–ª–µ–Ω–∏–π
skinparam diamond {
  BorderColor #666666
  backgroundColor #f0f0f0
  roundCorner 15
  FontSize 12
}

' ======== –û–§–ò–¶–ò–ê–õ–¨–ù–´–ï –¶–í–ï–¢–ê ========
' 
' –¶–≤–µ—Ç–∞ –∫–∞—Ä—Ç–æ—á–µ–∫ –≤–∑—è—Ç—ã –∏–∑ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞ –º–µ—Ç–æ–¥–æ–ª–æ–≥–∏–∏ –∫–∞—Ä—Ç –≥–∏–ø–æ—Ç–µ–∑.
' –ö–∞–∂–¥—ã–π —Ç–∏–ø —ç–ª–µ–º–µ–Ω—Ç–∞ –∏–º–µ–µ—Ç —Å–≤–æ–π —É–Ω–∏–∫–∞–ª—å–Ω—ã–π —Ü–≤–µ—Ç –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è.

!$GOAL_COLOR = "#cee265"
!$SUBJECT_COLOR = "#f5d127"
!$HYPOTHESIS_COLOR = "#fcf3af"
!$TASK_COLOR = "#c6d4f9"
!$NEGATIVE_SUBJECT_COLOR = "#ffc191"

' –¶–≤–µ—Ç–∞ –¥–ª—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ (—Ñ–æ–Ω —Ü–≤–µ—Ç–Ω—ã—Ö –±–ª–æ–∫–æ–≤ —Å —Ü–∏—Ñ—Ä–∞–º–∏)
!$HIGH_PRIORITY_BG = "#f24725"
!$MEDIUM_PRIORITY_BG = "#fef444"
!$LOW_PRIORITY_BG = "#8fd14f"

' –¶–≤–µ—Ç–∞ –¥–ª—è —Å–≤—è–∑–µ–π –º–µ–∂–¥—É —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ (–ª–∏–Ω–∏–∏ –∏ —Å—Ç—Ä–µ–ª–∫–∏)
!$HIGH_PRIORITY_LINE = "#f24726"
!$MEDIUM_PRIORITY_LINE = "#fbe32d"
!$LOW_PRIORITY_LINE = "#8fd14f"
!$DEFAULT_LINE = "#171717"

' ======== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ========

' –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–∞–∑–±–∏–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ –ø–æ —Å–∏–º–≤–æ–ª—É ";" —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –Ω—É–º–µ—Ä–∞—Ü–∏–µ–π
' –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–ø–∏—Å–∫–æ–≤ –≤ –∫–∞—Ä—Ç–æ—á–∫–∞—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–ø–∏—Å–æ–∫ –º–µ—Ç—Ä–∏–∫)
' –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: $text - —Å—Ç—Ä–æ–∫–∞ —Å —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏, —Ä–∞–∑–¥–µ–ª–µ–Ω–Ω—ã–º–∏ —Ç–æ—á–∫–æ–π —Å –∑–∞–ø—è—Ç–æ–π
' –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: –ø—Ä–æ–Ω—É–º–µ—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫, –∫–∞–∂–¥—ã–π —ç–ª–µ–º–µ–Ω—Ç –Ω–∞ –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–µ
!function $formatList($text)
  !if ($text == "")
    !return ""
  !endif
  
  !$result = ""
  !$remaining = $text
  !$counter = 1
  !$pos = %strpos($remaining, ";")
  
  ' –ü—Ä–æ—Ö–æ–¥–∏–º –ø–æ –≤—Å–µ–º —ç–ª–µ–º–µ–Ω—Ç–∞–º, —Ä–∞–∑–¥–µ–ª–µ–Ω–Ω—ã–º —Ç–æ—á–∫–æ–π —Å –∑–∞–ø—è—Ç–æ–π
  !while ($pos >= 0)
    !$item = %substr($remaining, 0, $pos)
    !if (%strlen($item) > 0)
      !$result = $result + $counter + ". " + $item + "\n"
      !$counter = $counter + 1
    !endif
    !$remaining = %substr($remaining, $pos+1)
    !$pos = %strpos($remaining, ";")
  !endwhile
  
  ' –î–æ–±–∞–≤–ª—è–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–π —ç–ª–µ–º–µ–Ω—Ç (–ø–æ—Å–ª–µ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Ç–æ—á–∫–∏ —Å –∑–∞–ø—è—Ç–æ–π)
  !if (%strlen($remaining) > 0)
    !$result = $result + $counter + ". " + $remaining
  !endif
  !return $result
!endfunction

' –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ü–≤–µ—Ç–Ω–æ–≥–æ –±–ª–æ–∫–∞ —Å –Ω–æ–º–µ—Ä–æ–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞
' –°–æ–∑–¥–∞–µ—Ç —Ü–≤–µ—Ç–Ω–æ–π –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫ —Å –±–µ–ª—ã–º —Ç–µ–∫—Å—Ç–æ–º –¥–ª—è –∏–Ω–¥–∏–∫–∞—Ü–∏–∏ —É—Ä–æ–≤–Ω—è –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞
' –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: $value - —É—Ä–æ–≤–µ–Ω—å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ (1=–Ω–∏–∑–∫–∏–π, 2=—Å—Ä–µ–¥–Ω–∏–π, 3=–≤—ã—Å–æ–∫–∏–π)
' –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: HTML-—Ä–∞–∑–º–µ—Ç–∫—É –¥–ª—è —Ü–≤–µ—Ç–Ω–æ–≥–æ –±–ª–æ–∫–∞ –∏–ª–∏ –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É –¥–ª—è 0
!function $priorityBlock($value)
  !if ($value == 3)
    !return "<back:" + $HIGH_PRIORITY_LINE + "><color:black> " + $value + " </color></back>"
  !elseif ($value == 2)
    !return "<back:" + $MEDIUM_PRIORITY_LINE + "><color:black> " + $value + " </color></back>"
  !elseif ($value == 1)
    !return "<back:" + $LOW_PRIORITY_LINE + "><color:black> " + $value + " </color></back>"
  !else
    !return ""
  !endif
!endfunction

' –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–≤—è–∑–µ–π —ç–ª–µ–º–µ–Ω—Ç–∞ —Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ —Ü–µ–ª—è–º–∏
' –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å—Ç—Ä–æ–∫—É —Å –∏–º–µ–Ω–∞–º–∏ —Ü–µ–ª–µ–π, —Ä–∞–∑–¥–µ–ª–µ–Ω–Ω—ã–º–∏ —Ç–æ—á–∫–æ–π —Å –∑–∞–ø—è—Ç–æ–π,
' –∏ —Å–æ–∑–¥–∞–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —Å–≤—è–∑–∏ —Å —É—á–µ—Ç–æ–º —É—Ä–æ–≤–Ω—è –≤–ª–∏—è–Ω–∏—è
' –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ñ–æ—Ä–º–∞—Ç "alias:–ø–æ–¥–ø–∏—Å—å" –¥–ª—è –≤–µ—Ç–≤–ª–µ–Ω–∏–π
' –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: 
'   $from - —ç–ª–µ–º–µ–Ω—Ç-–∏—Å—Ç–æ—á–Ω–∏–∫ —Å–≤—è–∑–∏
'   $targets - —Å—Ç—Ä–æ–∫–∞ —Å –∏–º–µ–Ω–∞–º–∏ —Ü–µ–ª–µ–π —á–µ—Ä–µ–∑ ";" (—Ñ–æ—Ä–º–∞—Ç: "alias" –∏–ª–∏ "alias:–ø–æ–¥–ø–∏—Å—å")
'   $influence - —É—Ä–æ–≤–µ–Ω—å –≤–ª–∏—è–Ω–∏—è (1-3 –¥–ª—è —Ü–≤–µ—Ç–Ω—ã—Ö —Å–≤—è–∑–µ–π, 4+ –¥–ª—è –æ–±—ã—á–Ω—ã—Ö)
!unquoted procedure $connectToTargets($from, $targets, $influence)
  !$items = $targets + ";"
  !$pos = %strpos($items, ";")
  !while ($pos > 0)
    !$item = %substr($items, 0, $pos)
    !if (%strlen($item) > 0)
      ' –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –¥–≤–æ–µ—Ç–æ—á–∏–µ (—Ñ–æ—Ä–º–∞—Ç alias:–ø–æ–¥–ø–∏—Å—å)
      !$colonPos = %strpos($item, ":")
      !if ($colonPos >= 0)
        !$target = %substr($item, 0, $colonPos)
        !$label = %substr($item, $colonPos + 1)
      !else
        !$target = $item
        !$label = " "
      !endif
      
      $target -[hidden]-> $from
      !if ($influence == 3)
        HighRel($from, $target, $label)
      !elseif ($influence == 2)
        MediumRel($from, $target, $label)
      !elseif ($influence == 1)
        LowRel($from, $target, $label)
      !elseif ($influence > 0)
        !if ($label == " ")
          $from --> $target
        !else
          $from --> $target : $label
        !endif
      !endif
    !endif
    !$items = %substr($items, $pos + 1)
    !$pos = %strpos($items, ";")
  !endwhile
!endprocedure

' –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º
' –û–±—ä–µ–¥–∏–Ω—è–µ—Ç –±–∞–∑–æ–≤—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç –∫–∞—Ä—Ç–æ—á–∫–∏ —Å —Ü–≤–µ—Ç–Ω—ã–º –±–ª–æ–∫–æ–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞
' –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
'   $baseContent - –æ—Å–Ω–æ–≤–Ω–æ–π —Ç–µ–∫—Å—Ç –∫–∞—Ä—Ç–æ—á–∫–∏
'   $influence - —É—Ä–æ–≤–µ–Ω—å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ (0 = –±–µ–∑ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞, 1-3 = —Å —Ü–≤–µ—Ç–Ω—ã–º –±–ª–æ–∫–æ–º)
' –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: –≥–æ—Ç–æ–≤—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –∫–∞—Ä—Ç–æ—á–∫–µ
!function $createContentWithPriority($baseContent, $influence)
  !$prio = $priorityBlock($influence)
  !if ($prio != "")
    !return $prio + "\n" + $baseContent
  !else
    !return $baseContent
  !endif
!endfunction

' –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å–µ–∫—Ü–∏–∏ —Å –Ω—É–º–µ—Ä–æ–≤–∞–Ω–Ω—ã–º —Å–ø–∏—Å–∫–æ–º –≤ –∫–æ–Ω—Ç–µ–Ω—Ç –∫–∞—Ä—Ç–æ—á–∫–∏
' –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –º–µ—Ç—Ä–∏–∫, –±–∞–ª–∞–Ω—Å–∏—Ä—É—é—â–∏—Ö –º–µ—Ç—Ä–∏–∫ –∏ –¥—Ä—É–≥–∏—Ö —Å–ø–∏—Å–∫–æ–≤
' –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
'   $content - —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç –∫–∞—Ä—Ç–æ—á–∫–∏
'   $title - –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å–µ–∫—Ü–∏–∏ (–±—É–¥–µ—Ç –≤—ã–¥–µ–ª–µ–Ω –∂–∏—Ä–Ω—ã–º)
'   $text - —Ç–µ–∫—Å—Ç —Å —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ —á–µ—Ä–µ–∑ ";" (–±—É–¥–µ—Ç –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω –≤ –Ω—É–º–µ—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫)
' –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç —Å –Ω–æ–≤–æ–π —Å–µ–∫—Ü–∏–µ–π –∏–ª–∏ –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç, –µ—Å–ª–∏ $text –ø—É—Å—Ç
!function $addSection($content, $title, $text)
  !if ($text != "")
    !return $content + "\n**" + $title + ":**\n" + $formatList($text)
  !endif
  !return $content
!endfunction

' –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Å—Ç–æ–π —Å–µ–∫—Ü–∏–∏ (–æ–¥–Ω–∞ —Å—Ç—Ä–æ–∫–∞) –≤ –∫–æ–Ω—Ç–µ–Ω—Ç –∫–∞—Ä—Ç–æ—á–∫–∏
' –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –±–æ–ª–µ–π, –∂–µ–ª–∞–Ω–∏–π, –ø—Ä–∏—á–∏–Ω –∏ –¥—Ä—É–≥–∏—Ö –æ–¥–Ω–æ—Å—Ç—Ä–æ—á–Ω—ã—Ö –ø–æ–ª–µ–π
' –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
'   $content - —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç –∫–∞—Ä—Ç–æ—á–∫–∏
'   $title - –∑–∞–≥–æ–ª–æ–≤–æ–∫ –ø–æ–ª—è (–±—É–¥–µ—Ç –≤—ã–¥–µ–ª–µ–Ω –∂–∏—Ä–Ω—ã–º)
'   $text - —Ç–µ–∫—Å—Ç –ø–æ–ª—è (–æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É)
' –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç —Å –Ω–æ–≤—ã–º –ø–æ–ª–µ–º –∏–ª–∏ –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç, –µ—Å–ª–∏ $text –ø—É—Å—Ç
!function $addSimpleSection($content, $title, $text)
  !if ($text != "")
    !return $content + "\n**" + $title + ":** " + $text
  !endif
  !return $content
!endfunction

' –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —ç–º–æ–¥–∑–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å—Ç–∞—Ç—É—Å–∞ –≥–∏–ø–æ—Ç–µ–∑—ã
' –î–æ–±–∞–≤–ª—è–µ—Ç –≤–∏–∑—É–∞–ª—å–Ω—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞
' –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: $status - —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å –≥–∏–ø–æ—Ç–µ–∑—ã
' –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: —ç–º–æ–¥–∑–∏ + —Å—Ç–∞—Ç—É—Å –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ —Å—Ç–∞—Ç—É—Å, –µ—Å–ª–∏ —ç–º–æ–¥–∑–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ
!function $getStatusEmoji($status)
  !if ($status == "–Ω–æ–≤–∞—è")
    !return "üÜï " + $status
  !elseif ($status == "—Å—Ä–∞–±–æ—Ç–∞–ª–∞")
    !return "‚úÖ " + $status
  !elseif ($status == "–æ—Ç–∫–ª–æ–Ω–µ–Ω–∞")
    !return "‚ùå " + $status
  !endif
  !return $status
!endfunction

' ======== –°–í–Ø–ó–ò ========
' 
' –ü—Ä–æ—Ü–µ–¥—É—Ä—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–≤—è–∑–µ–π —Ä–∞–∑–Ω–æ–≥–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ –º–µ–∂–¥—É —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏.
' –ö–∞–∂–¥—ã–π —Ç–∏–ø —Å–≤—è–∑–∏ –∏–º–µ–µ—Ç —Å–≤–æ–π —Ü–≤–µ—Ç –∏ —Ç–æ–ª—â–∏–Ω—É –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑–ª–∏—á–µ–Ω–∏—è –≤–∞–∂–Ω–æ—Å—Ç–∏.

' –°–≤—è–∑—å –≤—ã—Å–æ–∫–æ–≥–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ - –∫—Ä–∞—Å–Ω–∞—è, –æ—á–µ–Ω—å —Ç–æ–ª—Å—Ç–∞—è (thickness=6)
' –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã—Ö —Å–≤—è–∑–µ–π –∏ –≤—ã—Å–æ–∫–æ–≥–æ –≤–ª–∏—è–Ω–∏—è
!unquoted procedure HighRel($from, $to, $label=" ")
  !if ($label == " ")
    $from -[#f24726,thickness=6]-> $to : <size:0>.</size>
  !else
    $from -[#f24726,thickness=6]-> $to : $label
  !endif
!endprocedure

' –°–≤—è–∑—å —Å—Ä–µ–¥–Ω–µ–≥–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ - –∂–µ–ª—Ç–∞—è, —Å—Ä–µ–¥–Ω—è—è —Ç–æ–ª—â–∏–Ω–∞ (thickness=4)
' –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —É–º–µ—Ä–µ–Ω–Ω–æ –≤–∞–∂–Ω—ã—Ö —Å–≤—è–∑–µ–π –∏ —Å—Ä–µ–¥–Ω–µ–≥–æ –≤–ª–∏—è–Ω–∏—è
!unquoted procedure MediumRel($from, $to, $label=" ")
  !if ($label == " ")
    $from -[#fbe32d,thickness=4]-> $to : <size:0>.</size>
  !else
    $from -[#fbe32d,thickness=4]-> $to : $label
  !endif
!endprocedure

' –°–≤—è–∑—å –Ω–∏–∑–∫–æ–≥–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ - –∑–µ–ª–µ–Ω–∞—è, —Ç–æ–Ω–∫–∞—è (thickness=1)
' –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≤—Ç–æ—Ä–æ—Å—Ç–µ–ø–µ–Ω–Ω—ã—Ö —Å–≤—è–∑–µ–π –∏ –Ω–∏–∑–∫–æ–≥–æ –≤–ª–∏—è–Ω–∏—è
!unquoted procedure LowRel($from, $to, $label=" ")
  !if ($label == " ")
    $from -[#8fd14f,thickness=1]-> $to : <size:0>.</size>
  !else
    $from -[#8fd14f,thickness=1]-> $to : $label
  !endif
!endprocedure

' ======== –û–°–ù–û–í–ù–´–ï –≠–õ–ï–ú–ï–ù–¢–´ ========
' 
' –ü—Ä–æ—Ü–µ–¥—É—Ä—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –æ—Å–Ω–æ–≤–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∫–∞—Ä—Ç—ã –≥–∏–ø–æ—Ç–µ–∑.
' –ö–∞–∂–¥–∞—è –ø—Ä–æ—Ü–µ–¥—É—Ä–∞ —Å–æ–∑–¥–∞–µ—Ç –∫–∞—Ä—Ç–æ—á–∫—É –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ —Ç–∏–ø–∞ —Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º —Ü–≤–µ—Ç–æ–º –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π.

' –°–æ–∑–¥–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞ "–¶–µ–ª—å"
' –¶–µ–ª–∏ –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç –∂–µ–ª–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏ —Å–æ–¥–µ—Ä–∂–∞—Ç –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –∏–∑–º–µ—Ä–µ–Ω–∏—è —É—Å–ø–µ—Ö–∞
' –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
'   $alias - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –¥–ª—è —Å—Å—ã–ª–æ–∫ –Ω–∞ —ç—Ç–æ—Ç —ç–ª–µ–º–µ–Ω—Ç
'   $goal - –æ—Å–Ω–æ–≤–Ω–æ–π —Ç–µ–∫—Å—Ç —Ü–µ–ª–∏
'   $metrics - –º–µ—Ç—Ä–∏–∫–∏ —á–µ—Ä–µ–∑ ";" (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
'   $balancing_metrics - –±–∞–ª–∞–Ω—Å–∏—Ä—É—é—â–∏–µ –º–µ—Ç—Ä–∏–∫–∏ —á–µ—Ä–µ–∑ ";" (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
!unquoted procedure Goal($alias, $goal, $metrics="", $balancing_metrics="")
  !$content = $goal
  !$content = $addSection($content, "–ú–µ—Ç—Ä–∏–∫–∏", $metrics)
  !$content = $addSection($content, "–ë–∞–ª–∞–Ω—Å–∏—Ä—É—é—â–∏–µ", $balancing_metrics)
  rectangle "$content" as $alias $GOAL_COLOR
!endprocedure

' –°–æ–∑–¥–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞ "–°—É–±—ä–µ–∫—Ç"
' –°—É–±—ä–µ–∫—Ç—ã - —ç—Ç–æ –∑–∞–∏–Ω—Ç–µ—Ä–µ—Å–æ–≤–∞–Ω–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã, –∫–æ—Ç–æ—Ä—ã–µ –≤–ª–∏—è—é—Ç –Ω–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ —Ü–µ–ª–µ–π
' –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
'   $alias - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
'   $targets - —Ü–µ–ª–∏, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–µ –≤–ª–∏—è–µ—Ç —Å—É–±—ä–µ–∫—Ç (—á–µ—Ä–µ–∑ ";")
'   $description - –æ–ø–∏—Å–∞–Ω–∏–µ —Å—É–±—ä–µ–∫—Ç–∞
'   $pains - –±–æ–ª–∏ –∏ –ø—Ä–æ–±–ª–µ–º—ã —Å—É–±—ä–µ–∫—Ç–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
'   $desires - –∂–µ–ª–∞–Ω–∏—è –∏ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏ —Å—É–±—ä–µ–∫—Ç–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
'   $influence - —É—Ä–æ–≤–µ–Ω—å –≤–ª–∏—è–Ω–∏—è –Ω–∞ —Ü–µ–ª–∏ (0=–±–µ–∑ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞, 1=–Ω–∏–∑–∫–∏–π, 2=—Å—Ä–µ–¥–Ω–∏–π, 3=–≤—ã—Å–æ–∫–∏–π)
!unquoted procedure Subject($alias, $targets, $description, $pains, $desires, $influence = 0)
  !$content = $description
  !$content = $addSimpleSection($content, "–ë–æ–ª–∏", $pains)
  !$content = $addSimpleSection($content, "–ñ–µ–ª–∞–Ω–∏—è", $desires)
  
  !$displayContent = $createContentWithPriority($content, $influence)
  rectangle "$displayContent" as $alias $SUBJECT_COLOR
  
  $connectToTargets($alias, $targets, $influence)
!endprocedure

' –°–æ–∑–¥–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞ "–ù–µ–≥–∞—Ç–∏–≤–Ω—ã–π —Å—É–±—ä–µ–∫—Ç"
' –ù–µ–≥–∞—Ç–∏–≤–Ω—ã–µ —Å—É–±—ä–µ–∫—Ç—ã - —ç—Ç–æ —Å—Ç–æ—Ä–æ–Ω—ã, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤—É—é—Ç –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—é —Ü–µ–ª–µ–π
' –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã –æ–±—ã—á–Ω–æ–º—É —Å—É–±—ä–µ–∫—Ç—É, –Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ—Ä–∞–Ω–∂–µ–≤—ã–π —Ü–≤–µ—Ç
!unquoted procedure NegativeSubject($alias, $targets, $description, $pains, $desires, $influence)
  !$content = $description
  !$content = $addSimpleSection($content, "–ë–æ–ª–∏", $pains)
  !$content = $addSimpleSection($content, "–ñ–µ–ª–∞–Ω–∏—è", $desires)
  
  !$displayContent = $createContentWithPriority($content, $influence)
  rectangle "$displayContent" as $alias $NEGATIVE_SUBJECT_COLOR
  
  $connectToTargets($alias, $targets, $influence)
!endprocedure

' –°–æ–∑–¥–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞ "–ì–∏–ø–æ—Ç–µ–∑–∞"
' –ì–∏–ø–æ—Ç–µ–∑—ã –æ–ø–∏—Å—ã–≤–∞—é—Ç –ø—Ä–µ–¥–ø–æ–ª–æ–∂–µ–Ω–∏—è –æ —Ç–æ–º, –∫–∞–∫ –¥–æ—Å—Ç–∏—á—å —Ü–µ–ª–µ–π
' –ò—Å–ø–æ–ª—å–∑—É—é—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É "–ï—Å–ª–∏... –¢–æ... –ü–æ—Ç–æ–º—É —á—Ç–æ..."
' –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
'   $alias - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
'   $targets - —Ü–µ–ª–∏, –∫–æ—Ç–æ—Ä—ã—Ö –∫–∞—Å–∞–µ—Ç—Å—è –≥–∏–ø–æ—Ç–µ–∑–∞ (—á–µ—Ä–µ–∑ ";")
'   $if_part - —É—Å–ª–æ–≤–∏–µ –≥–∏–ø–æ—Ç–µ–∑—ã ("–ï—Å–ª–∏...")
'   $then_part - –æ–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç ("–¢–æ...")
'   $because_part - –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ ("–ü–æ—Ç–æ–º—É —á—Ç–æ...")
'   $influence - –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –≥–∏–ø–æ—Ç–µ–∑—ã (0-3)
'   $cost - —Å—Ç–æ–∏–º–æ—Å—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏ –≥–∏–ø–æ—Ç–µ–∑—ã (0-3)
'   $status - —Å—Ç–∞—Ç—É—Å –≥–∏–ø–æ—Ç–µ–∑—ã ("–Ω–æ–≤–∞—è", "—Å—Ä–∞–±–æ—Ç–∞–ª–∞", "–æ—Ç–∫–ª–æ–Ω–µ–Ω–∞")
'   $reason - –ø—Ä–∏—á–∏–Ω–∞ —Å—Ç–∞—Ç—É—Å–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
!unquoted procedure Hypothesis($alias, $targets, $if_part, $then_part, $because_part, $influence=0, $cost=0, $status=" ", $reason="")
  !$content = "**–ï—Å–ª–∏:** " + $if_part + "\n**–¢–æ:** " + $then_part + "\n**–ü–æ—Ç–æ–º—É —á—Ç–æ:** " + $because_part
  !$content = $addSimpleSection($content, "–ü—Ä–∏—á–∏–Ω–∞", $reason)
  
  !$moji = ""
  !if ($status != " ")
    !$moji = $getStatusEmoji($status)
  !endif
  
  !$prio = $priorityBlock($influence)
  
  ' –§–æ—Ä–º–∏—Ä—É–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏–∑ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ –∏ —Å—Ç–∞—Ç—É—Å–∞
  !$header = ""
  !if ($prio != "" and $moji != "")
    !$header = $prio + " " + $moji
  !elseif ($prio != "")
    !$header = $prio
  !elseif ($moji != "")
    !$header = $moji
  !endif

  !$finalContent = $content
  !if ($header != "")
    !$finalContent = $header + "\n" + $content
  !endif
  
  ' –î–æ–±–∞–≤–ª—è–µ–º –±–ª–æ–∫ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –≤ –∫–æ–Ω—Ü–µ, –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω
  !$costBlock = $priorityBlock($cost)
  !if ($costBlock != "")
    !$finalContent = $finalContent + "\n" + $costBlock
  !endif
  
  rectangle "$finalContent" as $alias $HYPOTHESIS_COLOR
  $connectToTargets($alias, $targets, $influence)
!endprocedure

' –°–æ–∑–¥–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞ "–ó–∞–¥–∞—á–∞"
' –ó–∞–¥–∞—á–∏ –æ–ø–∏—Å—ã–≤–∞—é—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≥–∏–ø–æ—Ç–µ–∑ –∏–ª–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —Ü–µ–ª–µ–π
' –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
'   $alias - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
'   $targets - —Å–≤—è–∑–∞–Ω–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã (—á–µ—Ä–µ–∑ ";")
'   $task_description - –æ–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏
'   $readiness - –ø—Ä–æ—Ü–µ–Ω—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
'   $deadline - —Å—Ä–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
!unquoted procedure Task($alias, $targets, $task_description, $readiness="", $deadline="")
  !$content = $task_description
  !if ($readiness != "")
    !$content = $addSimpleSection($content, "–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å", $readiness + "%")
  !endif
  !$content = $addSimpleSection($content, "–î–µ–¥–ª–∞–π–Ω", $deadline)
  rectangle "$content" as $alias $TASK_COLOR
  ' –ó–∞–¥–∞—á–∏ –∏–º–µ—é—Ç –æ—Å–æ–±—ã–π —Ç–∏–ø —Å–≤—è–∑–∏ (4 –æ–∑–Ω–∞—á–∞–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é —Å–≤—è–∑—å –±–µ–∑ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞)
  $connectToTargets($alias, $targets, 4)
!endprocedure

' –°–æ–∑–¥–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞ "–ú–µ—Ç—Ä–∏–∫–∞"
' –ú–µ—Ç—Ä–∏–∫–∏ –∏–∑–º–µ—Ä—è—é—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å –≤ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ —Ü–µ–ª–µ–π
' –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
'   $alias - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
'   $goal_alias - –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ü–µ–ª–∏, –∫ –∫–æ—Ç–æ—Ä–æ–π –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –º–µ—Ç—Ä–∏–∫–∞
'   $metric_text - –æ–ø–∏—Å–∞–Ω–∏–µ –º–µ—Ç—Ä–∏–∫–∏
'   $influence - –≤–∞–∂–Ω–æ—Å—Ç—å –º–µ—Ç—Ä–∏–∫–∏ (0-3, –≤–ª–∏—è–µ—Ç –Ω–∞ —Ü–≤–µ—Ç —Å–≤—è–∑–∏ —Å —Ü–µ–ª—å—é)
!unquoted procedure Metric($alias, $goal_alias, $metric_text, $influence = 0)
  !$content = $createContentWithPriority($metric_text, $influence)
  rectangle "$content" as $alias $GOAL_COLOR

  ' –°–æ–∑–¥–∞–µ–º —Å–≤—è–∑—å —Å —Ü–µ–ª—å—é –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤–∞–∂–Ω–æ—Å—Ç–∏ –º–µ—Ç—Ä–∏–∫–∏
  !if ($influence == 3)
    HighRel($alias, $goal_alias) 
  !elseif ($influence == 2)
    MediumRel($alias, $goal_alias)
  !elseif ($influence == 1)
    LowRel($alias, $goal_alias)
  !endif
  ' –°–∫—Ä—ã—Ç–∞—è —Å–≤—è–∑—å –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
  $goal_alias -[hidden]-> $alias
!endprocedure

' –°–æ–∑–¥–∞–Ω–∏–µ –≥—Ä—É–ø–ø–∏—Ä—É—é—â–µ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
' –ì—Ä—É–ø–ø—ã –ø–æ–º–æ–≥–∞—é—Ç –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å —Å–≤—è–∑–∞–Ω–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–∞ –¥–∏–∞–≥—Ä–∞–º–º–µ
' –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
'   $alias - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
'   $label - –Ω–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã
'   $color - —Ü–≤–µ—Ç —Ñ–æ–Ω–∞ –≥—Ä—É–ø–ø—ã (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–≤–µ—Ç–ª–æ-—Å–µ—Ä—ã–π)
'   $comment - –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –ø–æ–¥ –Ω–∞–∑–≤–∞–Ω–∏–µ–º (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –º–µ–ª–∫–∏–º –∫—É—Ä—Å–∏–≤–æ–º)
!unquoted procedure Group($alias, $label, $color="#f2f2f2", $comment="")
  !$content = $label
  !if ($comment != "")
    !$content = $content + "\n<size:10><i>" + $comment + "</i></size>"
  !endif
  rectangle "$content" as $alias $color
!endprocedure

' –°–æ–∑–¥–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞ "–í–µ—Ç–≤–ª–µ–Ω–∏–µ"
' –í–µ—Ç–≤–ª–µ–Ω–∏—è –æ–ø–∏—Å—ã–≤–∞—é—Ç –≤—ã–±–æ—Ä –º–µ–∂–¥—É –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞–º–∏
' –°–≤—è–∑–∏ –∏ –ø–æ–¥–ø–∏—Å–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑ targets –¥—Ä—É–≥–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
' –§–æ—Ä–º–∞—Ç target: "alias:–ø–æ–¥–ø–∏—Å—å" –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ "alias"
' –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
'   $alias - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
'   $from_targets - —ç–ª–µ–º–µ–Ω—Ç—ã, –æ—Ç –∫–æ—Ç–æ—Ä—ã—Ö –∑–∞–≤–∏—Å–∏—Ç –≤–µ—Ç–≤–ª–µ–Ω–∏–µ (—á–µ—Ä–µ–∑ ";")
'   $influence - –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç/–≤–∞–∂–Ω–æ—Å—Ç—å –≤–µ—Ç–≤–ª–µ–Ω–∏—è (0=–æ–±—ã—á–Ω—ã–π, 1=–Ω–∏–∑–∫–∏–π, 2=—Å—Ä–µ–¥–Ω–∏–π, 3=–≤—ã—Å–æ–∫–∏–π)
!unquoted procedure Decision($alias, $from_targets, $influence=0)
  diamond " " as $alias
  
  ' –°–æ–∑–¥–∞–µ–º –≤—Ö–æ–¥—è—â–∏–µ —Å–≤—è–∑–∏ (–æ—Ç from_targets –∫ Decision)
  !if ($from_targets != "")
    !$items = $from_targets + ";"
    !$pos = %strpos($items, ";")
    !while ($pos > 0)
      !$target = %substr($items, 0, $pos)
      !if (%strlen($target) > 0)
        !if ($influence == 3)
          $target <-[$HIGH_PRIORITY_LINE,thickness=6]- $alias
        !elseif ($influence == 2)
          $target <-[$MEDIUM_PRIORITY_LINE,thickness=4]- $alias
        !elseif ($influence == 1)
          $target <-[$LOW_PRIORITY_LINE,thickness=1]- $alias
        !else
          $target <-[$DEFAULT_LINE,thickness=1]- $alias
      !endif
      !$items = %substr($items, $pos + 1)
      !$pos = %strpos($items, ";")
    !endwhile
  !endif
  
  ' –ò—Å—Ö–æ–¥—è—â–∏–µ —Å–≤—è–∑–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ $connectToTargets –≤ –¥—Ä—É–≥–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–∞—Ö
!endprocedure

' ======== –ù–ê–°–¢–†–û–ô–ö–ò –ú–ê–ö–ï–¢–ê ========

' –ü—Ä–æ—Ü–µ–¥—É—Ä–∞ –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–∏–∞–≥—Ä–∞–º–º—ã
' –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –ª—É—á—à–µ–≥–æ –≤–æ—Å–ø—Ä–∏—è—Ç–∏—è –∫–∞—Ä—Ç –≥–∏–ø–æ—Ç–µ–∑
!unquoted procedure LAYOUT_LEFT_TO_RIGHT()
  left to right direction
!endprocedure

' ======== –õ–ï–ì–ï–ù–î–ê ========
' 
' –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–Ω–µ—à–Ω–µ–≥–æ –≤–∏–¥–∞ –ª–µ–≥–µ–Ω–¥—ã

skinparam legend {
  backgroundColor transparent
  borderColor transparent
}

skinparam legendFontSize 14
skinparam legendFontName "Segoe UI"
skinparam legendMargin 4

' –ü—Ä–æ—Ü–µ–¥—É—Ä–∞ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ª–µ–≥–µ–Ω–¥—ã —Å —Ü–≤–µ—Ç–æ–≤–æ–π —Å—Ö–µ–º–æ–π
' –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç, –∫–∞–∫–æ–π —Ü–≤–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∫–∞–∫–æ–º—É —Ç–∏–ø—É —ç–ª–µ–º–µ–Ω—Ç–∞
!unquoted procedure SHOW_LEGEND()
  legend right
    |<color:#cee265>  ‚ñ†  </color>| –¶–µ–ª—å, –º–µ—Ç—Ä–∏–∫–∏ |
    |<color:#f5d127>  ‚ñ†  </color>| –°—É–±—ä–µ–∫—Ç, –º–æ—Ç–∏–≤–∞—Ü–∏—è |
    |<color:#fcf3af>  ‚ñ†  </color>| –ì–∏–ø–æ—Ç–µ–∑–∞ |
    |<color:#c6d4f9>  ‚ñ†  </color>| –ó–∞–¥–∞—á–∞ |
    |<color:#ffc191>  ‚ñ†  </color>| –ù–µ–≥–∞—Ç–∏–≤–Ω—ã–π —Å—É–±—ä–µ–∫—Ç |
    |<color:#f0f0f0>  ‚óÜ  </color>| –í–µ—Ç–≤–ª–µ–Ω–∏–µ |
  endlegend
!endprocedure